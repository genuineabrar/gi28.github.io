
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GI28 ZENITM PRO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --panel: rgba(15, 15, 20, 0.95);
            --border: rgba(255, 255, 255, 0.15);
            --accent: #00ff88;
            --accent-dim: rgba(0, 255, 136, 0.2);
            --text-main: #ffffff;
            --text-muted: #888888;
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow: hidden;
            width: 100vw; height: 100vh;
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 1; touch-action: none; }

        /* --- UI OVERLAY --- */
        .ui-layer { position: absolute; width: 100%; height: 100%; z-index: 100; pointer-events: none; }

        /* --- LOADING SCREEN --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: opacity 0.5s;
        }
        .loader-text { font-family: var(--font-head); font-size: 24px; letter-spacing: 4px; color: var(--accent); animation: pulse 1s infinite; }
        .loader-sub { font-size: 12px; color: #555; margin-top: 10px; font-family: monospace; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* --- HEADER --- */
        .header {
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px 30px;
            display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            pointer-events: none; /* Ensure header doesn't block, but children do */
        }
        .logo { font-family: var(--font-head); font-weight: 900; font-size: 20px; letter-spacing: 2px; display: flex; align-items: center; gap: 10px; pointer-events: auto; }
        .logo span { color: var(--accent); }
        .status-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 10px var(--accent); }

        .btn-menu {
            pointer-events: auto; width: 48px; height: 48px; background: rgba(0,0,0,0.3);
            border: 1px solid var(--border); border-radius: 12px; color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            backdrop-filter: blur(10px);
            z-index: 200; /* Ensure it's on top */
        }
        .btn-menu:active { transform: scale(0.95); background: var(--accent); color: black; }

        /* --- SIDEBAR --- */
        .sidebar {
            position: absolute; top: 0; right: 0; width: 340px; height: 100%;
            background: var(--panel); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            border-left: 1px solid var(--border); transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); pointer-events: auto;
            display: flex; flex-direction: column;
            box-shadow: -20px 0 50px rgba(0,0,0,0.8);
            z-index: 300;
        }
        .sidebar.active { transform: translateX(0); }

        .sidebar-header { padding: 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .sidebar-title { font-family: var(--font-head); font-size: 14px; color: var(--text-muted); letter-spacing: 2px; }

        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }

        /* --- CONTROLS --- */
        .control-group { margin-bottom: 30px; }
        .control-title { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px;}

        .input-row { margin-bottom: 15px; }
        .label-flex { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-bottom: 8px; }
        
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background: #333; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--accent); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px var(--accent-dim); }

        input[type="text"] { width: 100%; background: #111; border: 1px solid var(--border); padding: 12px; color: white; border-radius: 6px; font-family: var(--font-body); }
        
        .btn-action { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; cursor: pointer; border-radius: 6px; font-weight: 700; transition: 0.2s; margin-top: 5px; }
        .btn-action:hover { background: var(--accent); color: black; }
        .btn-action:active { transform: scale(0.98); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .preset-card { background: #111; border: 1px solid var(--border); padding: 10px; text-align: center; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .preset-card:hover, .preset-card.active { border-color: var(--accent); background: var(--accent-dim); color: white; }
        .preset-card span { font-size: 10px; display: block; margin-top: 2px; color: #777; }

        /* --- LOG CONSOLE --- */
        .console-log {
            position: absolute; bottom: 20px; left: 20px;
            font-family: monospace; font-size: 10px; color: var(--text-muted);
            pointer-events: none; opacity: 0.7;
        }

        /* --- MOBILE --- */
        @media (max-width: 600px) {
            .sidebar { width: 100%; }
            .header { padding: 15px; }
            .btn-menu { width: 40px; height: 40px; }
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">GI28 ZENITM PRO</div>
        <div class="loader-sub">Initializing Physics Core...</div>
    </div>

    <div class="ui-layer">
        <header class="header">
            <div class="logo"><div class="status-dot"></div> ZENITM <span>PRO</span></div>
            <button class="btn-menu" id="menuBtn">
                <i class="fa-solid fa-sliders"></i>
            </button>
        </header>

        <div class="console-log" id="debugLog">System Ready.</div>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">CONFIGURATION</div>
                <button class="btn-menu" id="closeBtn" style="border:none; background:transparent;">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>

            <div class="sidebar-content">
                
                <div class="control-group">
                    <div class="control-title">Content Source</div>
                    <div class="grid-2" style="margin-bottom:15px;">
                        <div class="preset-card active" id="modeText" onclick="app.setMode('text')">
                            <i class="fa-solid fa-font"></i>
                            <span>Text</span>
                        </div>
                        <div class="preset-card" id="modeImage" onclick="app.setMode('image')">
                            <i class="fa-solid fa-image"></i>
                            <span>Image</span>
                        </div>
                    </div>

                    <div id="textControls">
                        <input type="text" id="inputText" value="ZENITM">
                        <button class="btn-action" onclick="app.renderText()">Update Text</button>
                    </div>

                    <div id="imageControls" style="display:none;">
                        <button class="btn-action" onclick="document.getElementById('fileInput').click()">Upload Image</button>
                        <input type="file" id="fileInput" hidden accept="image/*">
                        <p style="font-size:10px; color:#666; margin-top:10px; text-align:center;">High Contrast / Transparent PNG</p>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-title">Physics</div>
                    
                    <div class="input-row">
                        <div class="label-flex"><span>Resolution</span> <span id="lblGap">High</span></div>
                        <input type="range" id="rngGap" min="3" max="15" step="1" value="5" style="direction: rtl;"> 
                    </div>

                    <div class="input-row">
                        <div class="label-flex"><span>Particle Size</span> <span id="lblSize">1.5px</span></div>
                        <input type="range" id="rngSize" min="0.5" max="5" step="0.1" value="1.5">
                    </div>

                    <div class="input-row">
                        <div class="label-flex"><span>Mouse Force</span> <span id="lblForce">30</span></div>
                        <input type="range" id="rngForce" min="-50" max="50" step="5" value="30">
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-title">Visuals</div>
                    <div class="grid-2">
                        <div class="preset-card" onclick="app.setPreset('clean')">Clean White</div>
                        <div class="preset-card active" onclick="app.setPreset('cyber')">Cyber Green</div>
                        <div class="preset-card" onclick="app.setPreset('fire')">Inferno</div>
                        <div class="preset-card" onclick="app.setPreset('gold')">Luxury</div>
                    </div>
                </div>

                <div class="control-group">
                    <button class="btn-action" style="border-color: var(--accent); color: var(--accent);" onclick="app.snapshot()">ðŸ“¸ Save 4K Snapshot</button>
                </div>

            </div>
        </aside>
    </div>

    <canvas id="canvas1"></canvas>

    <script>
        /**
         * ZENITM ENGINE V4.1 (Mobile Fix)
         * - Isolated touch events to canvas only (fixed menu button bug)
         * - Optimized font loading
         */

        const canvas = document.getElementById('canvas1');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        
        // --- CORE STATE ---
        const config = {
            text: "ZENITM",
            gap: 5,
            size: 1.5,
            radius: 3000,
            forceMultiplier: 30, // + for push, - for pull
            mode: 'text', // text | image
            colorMode: 'cyber',
            uploadedImage: null,
            throttleRes: true // Limits scanning resolution to prevent crashes
        };

        const mouse = { x: undefined, y: undefined, active: false };
        let particles = [];
        let width, height;
        let dpr = 1;

        // --- UTILS ---
        const log = (msg) => {
            const el = document.getElementById('debugLog');
            if(el) el.innerText = `> ${msg}`;
        };

        // --- PARTICLE CLASS ---
        class Particle {
            constructor(x, y, color) {
                this.ox = x; 
                this.oy = y;
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.color = color;
                this.sizeVar = Math.random() * 0.5;
            }

            draw() {
                if (config.colorMode === 'cyber') ctx.fillStyle = '#00ff88';
                else if (config.colorMode === 'fire') ctx.fillStyle = `hsl(${10 + Math.random()*30}, 100%, 50%)`;
                else if (config.colorMode === 'gold') ctx.fillStyle = `hsl(45, ${70+Math.random()*30}%, 60%)`;
                else if (config.colorMode === 'image') ctx.fillStyle = this.color;
                else ctx.fillStyle = 'white'; 

                const s = config.size + this.sizeVar;
                ctx.fillRect(this.x, this.y, s, s);
            }

            update() {
                if (mouse.active) {
                    const dx = mouse.x - this.x;
                    const dy = mouse.y - this.y;
                    const distSq = dx * dx + dy * dy;

                    if (distSq < config.radius) {
                        const dist = Math.sqrt(distSq);
                        const force = (config.radius - distSq) / config.radius;
                        const angle = Math.atan2(dy, dx);
                        
                        const pX = Math.cos(angle) * force * config.forceMultiplier;
                        const pY = Math.sin(angle) * force * config.forceMultiplier;

                        this.vx -= pX;
                        this.vy -= pY;
                    }
                }

                this.vx += (this.ox - this.x) * 0.1;
                this.vy += (this.oy - this.y) * 0.1;
                this.vx *= 0.85;
                this.vy *= 0.85;
                this.x += this.vx;
                this.y += this.vy;
            }
        }

        // --- ENGINE ---
        const Engine = {
            init: async function() {
                log("Loading...");
                await document.fonts.ready; // Wait for custom fonts
                
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
                }, 800);

                this.resize();
                
                window.addEventListener('resize', () => {
                    clearTimeout(this.rsTimer);
                    this.rsTimer = setTimeout(() => this.resize(), 200);
                });

                this.animate();
                log("Ready.");
            },

            resize: function() {
                width = window.innerWidth;
                height = window.innerHeight;
                dpr = Math.min(window.devicePixelRatio, 2);
                
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                canvas.style.width = `${width}px`;
                canvas.style.height = `${height}px`;
                
                ctx.scale(dpr, dpr);

                if (config.mode === 'text') this.scanText();
                else if (config.mode === 'image') this.scanImage();
            },

            scanText: function() {
                log(`Rendering Text`);
                particles = [];
                ctx.clearRect(0, 0, width, height);

                const fontSize = Math.min(width * 0.18, 200);
                ctx.font = `900 ${fontSize}px 'Orbitron'`;
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(config.text, width/2, height/2);

                this.processPixels();
            },

            scanImage: function() {
                if (!config.uploadedImage) return;
                log("Rendering Image");
                particles = [];
                ctx.clearRect(0,0,width, height);

                const img = config.uploadedImage;
                const scale = Math.min((width * 0.8) / img.width, (height * 0.8) / img.height);
                const w = img.width * scale;
                const h = img.height * scale;
                const x = (width - w) / 2;
                const y = (height - h) / 2;

                ctx.drawImage(img, x, y, w, h);
                this.processPixels();
            },

            processPixels: function() {
                const pWidth = width * dpr;
                const pHeight = height * dpr;
                const imageData = ctx.getImageData(0, 0, pWidth, pHeight);
                const data = imageData.data;
                const gap = config.gap * dpr;

                for (let y = 0; y < pHeight; y += gap) {
                    for (let x = 0; x < pWidth; x += gap) {
                        const index = (y * pWidth + x) * 4;
                        if (data[index + 3] > 128) {
                            const r = data[index];
                            const g = data[index + 1];
                            const b = data[index + 2];
                            const col = `rgb(${r},${g},${b})`;
                            particles.push(new Particle(x/dpr, y/dpr, col));
                        }
                    }
                }
                ctx.clearRect(0, 0, width, height);
                log(`${particles.length} Particles`);
            },

            animate: function() {
                ctx.clearRect(0, 0, width, height);
                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw();
                }
                requestAnimationFrame(() => this.animate());
            }
        };

        // --- APP CONTROLLER ---
        const app = {
            setMode: (m) => {
                config.mode = m;
                document.getElementById('modeText').classList.toggle('active', m === 'text');
                document.getElementById('modeImage').classList.toggle('active', m === 'image');
                document.getElementById('textControls').style.display = m === 'text' ? 'block' : 'none';
                document.getElementById('imageControls').style.display = m === 'image' ? 'block' : 'none';
                if (m === 'text') Engine.scanText();
                else if (config.uploadedImage) Engine.scanImage();
            },
            renderText: () => {
                config.text = document.getElementById('inputText').value;
                Engine.scanText();
            },
            setPreset: (p) => {
                config.colorMode = p;
                document.querySelectorAll('.preset-card').forEach(el => el.classList.remove('active'));
                Engine.scanText(); // Refresh
            },
            snapshot: () => {
                const composite = document.createElement('canvas');
                composite.width = canvas.width;
                composite.height = canvas.height;
                const cCtx = composite.getContext('2d');
                cCtx.fillStyle = '#050505';
                cCtx.fillRect(0,0, composite.width, composite.height);
                cCtx.drawImage(canvas, 0, 0);
                const a = document.createElement('a');
                a.download = `ZENITM_GI28_${Date.now()}.png`;
                a.href = composite.toDataURL();
                a.click();
            }
        };

        // --- EVENTS ---
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (evt) => {
                const img = new Image();
                img.onload = () => {
                    config.uploadedImage = img;
                    app.setMode('image');
                    Engine.scanImage();
                };
                img.src = evt.target.result;
            };
            reader.readAsDataURL(file);
        });

        document.getElementById('rngGap').addEventListener('input', (e) => config.gap = parseInt(e.target.value));
        document.getElementById('rngGap').addEventListener('change', () => config.mode === 'text' ? Engine.scanText() : Engine.scanImage());
        document.getElementById('rngSize').addEventListener('input', (e) => config.size = parseFloat(e.target.value));
        document.getElementById('rngForce').addEventListener('input', (e) => config.forceMultiplier = parseInt(e.target.value));

        // --- MENU LOGIC ---
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.getElementById('menuBtn');
        const closeBtn = document.getElementById('closeBtn');

        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Stop event bubbling
            sidebar.classList.add('active');
        });
        
        closeBtn.addEventListener('click', () => {
            sidebar.classList.remove('active');
        });

        // Close on canvas tap
        canvas.addEventListener('click', () => {
             sidebar.classList.remove('active');
        });

        // --- TOUCH FIX: Attach physics listeners ONLY to canvas ---
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
            mouse.active = true;
        });

        // IMPORTANT: Passive: false allows us to preventDefault ONLY on canvas
        // forcing the particles to move without scrolling the page.
        canvas.addEventListener('touchstart', e => {
            e.preventDefault(); 
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.touches[0].clientX - rect.left;
            mouse.y = e.touches[0].clientY - rect.top;
            mouse.active = true;
        }, {passive: false});

        canvas.addEventListener('touchmove', e => {
            e.preventDefault(); 
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.touches[0].clientX - rect.left;
            mouse.y = e.touches[0].clientY - rect.top;
        }, {passive: false});

        canvas.addEventListener('touchend', () => mouse.active = false);

        // --- BOOT ---
        Engine.init();

    </script>
</body>
</html>
